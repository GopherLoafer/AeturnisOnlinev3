<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aeturnis Online - Game Dashboard</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body class="game-dashboard">
    <!-- Top Navigation -->
    <div class="top-nav">
        <div class="nav-left">
            <span class="logo">‚öîÔ∏è AETURNIS ONLINE</span>
        </div>
        <div class="nav-center">
            <span class="server-time" id="server-time">Loading...</span>
        </div>
        <div class="nav-right">
            <span class="gold">üí∞ <%= character.gold.toLocaleString() %></span>
            <span class="health">‚ù§Ô∏è <%= character.health_current %>/<%= character.health_max %></span>
            <span class="mana">üîÆ <%= character.mana_current %>/<%= character.mana_max %></span>
            <% if (user.is_admin) { %>
                <a href="/admin" class="admin-link">ADMIN PANEL</a>
            <% } %>
            <button class="menu-toggle" onclick="toggleMenu()">MENU</button>
        </div>
    </div>

    <div class="game-container">
        <!-- Left Sidebar - Dynamic Content -->
        <div class="panel left-sidebar">
            <div class="sidebar-content">
                <!-- Character Stats Tab Content (Default) -->
                <div id="character-stats" class="tab-content active">
                    <div class="character-info">
                        <h3><%= character.name %> 
                            <% if (character.prestige_marker) { %>
                                <span class="prestige-marker prestige-<%= character.prestige_marker %>">
                                    <% if (character.prestige_marker === 'bronze') { %>ü•â<% } %>
                                    <% if (character.prestige_marker === 'silver') { %>ü•à<% } %>
                                    <% if (character.prestige_marker === 'gold') { %>ü•á<% } %>
                                    <% if (character.prestige_marker === 'platinum') { %>üíé<% } %>
                                    <% if (character.prestige_marker === 'diamond') { %>üí†<% } %>
                                    <% if (character.prestige_marker === 'legendary') { %>‚≠ê<% } %>
                                </span>
                            <% } %>
                        </h3>
                        <p class="character-race">Race: <%= character.race_name %></p>
                        <p class="character-level">Level: <%= character.level %></p>
                        <div class="experience-section">
                            <p class="character-experience">Experience: <%= character.experience.toLocaleString() %></p>
                            <div class="exp-progress">
                                <div class="exp-bar">
                                    <div class="exp-fill" style="width: <%= progression.progressPercentage %>%"></div>
                                </div>
                                <div class="exp-text">
                                    <%= progression.currentLevelProgress.toLocaleString() %> / <%= progression.expNeededForNext.toLocaleString() %> (<%= progression.progressPercentage %>%)
                                </div>
                            </div>
                            <% if (progression.nextMilestone && progression.nextMilestone.levelsRemaining) { %>
                                <div class="next-milestone">
                                    <small>Next Milestone: Level <%= progression.nextMilestone.level %> (<%= progression.nextMilestone.levelsRemaining %> levels)</small>
                                </div>
                            <% } %>
                        </div>
                    </div>
                    
                    <div class="stats">
                        <h4>Stats</h4>
                        <div class="stat-row">
                            <span class="stat-label">STR</span>
                            <span class="stat-value"><%= character.str_base %></span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">INT</span>
                            <span class="stat-value"><%= character.int_base %></span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">VIT</span>
                            <span class="stat-value"><%= character.vit_base %></span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">DEX</span>
                            <span class="stat-value"><%= character.dex_base %></span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">WIS</span>
                            <span class="stat-value"><%= character.wis_base %></span>
                        </div>
                    </div>

                    <!-- Equipment Grid -->
                    <div class="equipment-section">
                        <h4>Equipment</h4>
                        <div class="equipment-grid">
                            <div class="equipment-slot helmet">üé©</div>
                            <div class="equipment-slot weapon">‚öîÔ∏è</div>
                            <div class="equipment-slot armor">üõ°Ô∏è</div>
                            <div class="equipment-slot shield">üõ°Ô∏è</div>
                            <div class="equipment-slot boots">üë¢</div>
                            <div class="equipment-slot gloves">üß§</div>
                        </div>
                    </div>
                </div>

                <!-- Inventory Tab Content -->
                <div id="inventory" class="tab-content">
                    <h4>Inventory</h4>
                    <div class="inventory-grid">
                        <div class="inventory-slot filled">‚öîÔ∏è</div>
                        <div class="inventory-slot filled">üó°Ô∏è</div>
                        <div class="inventory-slot filled">üî•</div>
                        <div class="inventory-slot filled">üß™</div>
                        <div class="inventory-slot empty"></div>
                        <div class="inventory-slot empty"></div>
                        <div class="inventory-slot empty"></div>
                        <div class="inventory-slot empty"></div>
                        <div class="inventory-slot empty"></div>
                    </div>
                </div>

                <!-- Skills Tab Content -->
                <div id="skills" class="tab-content">
                    <div class="skills-section">
                        <h4>Race Abilities</h4>
                        <div class="race-abilities-list" id="race-abilities">
                            <div class="loading">Loading abilities...</div>
                        </div>
                        
                        <h4>Weapon Affinities</h4>
                        <% weaponAffinities.forEach(affinity => { %>
                        <div class="skill-row">
                            <span class="skill-name"><%= affinity.weapon_type %></span>
                            <span class="skill-value"><%= parseFloat(affinity.affinity_percentage).toFixed(2) %>%</span>
                        </div>
                        <% }); %>
                        
                        <h4>Magic Affinities</h4>
                        <% magicAffinities.forEach(affinity => { %>
                        <div class="skill-row">
                            <span class="skill-name"><%= affinity.magic_school %></span>
                            <span class="skill-value"><%= parseFloat(affinity.affinity_percentage).toFixed(2) %>%</span>
                        </div>
                        <% }); %>
                    </div>
                </div>

                <!-- Progress Tab Content -->
                <div id="progression" class="tab-content">
                    <div class="progression-section">
                        <div class="progression-info">
                            <div class="stat-row">
                                <span class="stat-label">Level</span>
                                <span class="stat-value level"><%= character.level %></span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Experience</span>
                                <span class="stat-value"><%= character.experience.toLocaleString() %></span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: <%= progression.progressPercentage %>%"></div>
                                <span class="progress-text"><%= progression.progressPercentage %>%</span>
                            </div>
                            <% if (progression.nextMilestone && progression.nextMilestone.levelsRemaining) { %>
                            <div class="milestone-info">
                                <span class="milestone-label">Next Milestone:</span>
                                <span class="milestone-value">Level <%= progression.nextMilestone.level %></span>
                            </div>
                            <% } %>
                        </div>

                        <div class="progression-actions">
                            <button id="gain-100-exp" class="progression-btn small">+100 EXP</button>
                            <button id="gain-1000-exp" class="progression-btn small">+1K EXP</button>
                            <button id="simulate-levelup" class="progression-btn">Level Test</button>
                            <button id="view-leaderboard" class="progression-btn">Leaderboard</button>
                        </div>

                        <h4>Recent Rewards</h4>
                        <div id="rewards-display" class="rewards-display">
                            <div class="reward-message info">Start gaining experience to see rewards!</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="panel main-content">
            <!-- Tab Navigation -->
            <div class="main-tabs">
                <button class="main-tab-btn active" data-tab="character-stats">Character</button>
                <button class="main-tab-btn" data-tab="inventory">Inventory</button>
                <button class="main-tab-btn" data-tab="skills">Skills</button>
                <button class="main-tab-btn" data-tab="progression">Progress</button>
            </div>

            <!-- Game Text Area -->
            <div class="game-output" id="game-output">
                <div class="location-header">
                    <h3><%= character.location_zone.replace('_', ' ').toUpperCase() %> - Level <%= character.level %> Zone</h3>
                </div>
                <p>You find yourself in the <%= character.location_zone.replace('_', ' ') %>, blocking out most of the sunlight. You hear strange noises in the distance.</p>
                <p>You move north.</p>
                <p>A Wild Dire Wolf (Level 42) appears!</p>
                <p>You attack with your legendary Shadowfang blade!</p>
                <p class="combat-result success">The Dire Wolf strikes back with its claws!</p>
                <p class="combat-result damage">You take 158 damage!</p>
                <p class="combat-result success">You cast Fireball!</p>
                <p class="combat-result success">You deal 287 fire damage!</p>
                <p class="combat-result victory">You have defeated the Dire Wolf!</p>
                <p class="loot">You gain 1,250 experience points!</p>
                <p class="loot">You loot: 127 gold, Wolf Pelt (x2), Health Potion</p>
                <p class="inventory-full">Your sword mastery increases! (47/100)</p>
            </div>
        </div>
    </div>

    <!-- Movement Controls -->
    <div class="movement-controls">
        <button class="movement-btn" data-direction="north">NORTH</button>
        <button class="movement-btn" data-direction="south">SOUTH</button>
        <button class="movement-btn" data-direction="east">EAST</button>
        <button class="movement-btn" data-direction="west">WEST</button>
        <button class="movement-btn" data-direction="fight">FIGHT</button>
        <button class="movement-btn" data-direction="cast">CAST</button>
        <button class="movement-btn" data-direction="rest">REST</button>
        <button class="movement-btn" data-direction="map">MAP</button>
    </div>

    <!-- Chat System -->
    <div class="chat-container">
        <div class="chat-tabs">
            <button class="chat-tab active" data-channel="all">All</button>
            <button class="chat-tab" data-channel="guild">Guild</button>
            <button class="chat-tab" data-channel="party">Party</button>
            <button class="chat-tab" data-channel="combat">Combat</button>
        </div>
        <div class="chat-messages" id="chat-messages">
            <div class="chat-message system">Dragonslayer: Anyone want to group for Demon Tower?</div>
            <div class="chat-message system">BlMage: Cold raid starts in 30 minutes!</div>
            <div class="chat-message system">System: The mobile level 15 grue bought a 1000 Signups at any store!</div>
        </div>
        <div class="chat-input-container">
            <input type="text" id="chat-input" placeholder="Enter command (type 'help' for commands)" maxlength="255">
            <button id="send-btn">Send</button>
        </div>
    </div>

    <script src="/js/game.js"></script>
    <script>
        // Initialize the game when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeGame();
        });
    </script>
</body>
</html>